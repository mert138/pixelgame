<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Oyun Haritası</title>
  <style>
    body {
      margin: 0;
      background: #111;
      overflow: hidden;
      user-select: none;
    }
    canvas {
      width: 100vw;   
      height: 100vh;  
      image-rendering: pixelated; 
      display: block;
    }
    /* Tuşların stili */
    .control {
      position: fixed;
      bottom: 20px;
      left: 20px;
      display: grid;
      grid-template-columns: 50px 50px 50px;
      grid-template-rows: 50px 50px 50px;
      gap: 5px;
    }
    .button {
      width: 50px;
      height: 50px;
      background: rgba(255,255,255,0.3);
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 20px;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<!-- Yön tuşları -->
<div class="control">
  <div></div><div class="button" id="up">↑</div><div></div>
  <div class="button" id="left">←</div><div class="button" id="down">↓</div><div class="button" id="right">→</div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Resimler
const mapImg = new Image();
mapImg.src = "pixilart-drawing.png";

const characterImg = new Image();
characterImg.src = "karakter.png";

const characterImgArrow = new Image();
characterImgArrow.src = "karakter1.png";

const arrowImg = new Image();
arrowImg.src = "ok.png";

// Karakter objesi
let char = {
  x: 100,
  y: canvas.height - 150,
  width: 50,
  height: 50,
  dx: 0,
  dy: 0,
  speed: 5,
  jumpPower: 15,
  onGround: false
};

const gravity = 0.8;

// Platformlar
const platforms = [
  {x:0, y:canvas.height - 100, width: canvas.width, height: 100},
  {x:0, y:canvas.height - 330, width: 470, height: 20},
  {x:1450, y:canvas.height - 330, width: 470, height: 20},
];

// Merdivenlar
const ladders = [
  {x:55, y:canvas.height - 330, width: 50, height: 200},
  {x:1800, y:canvas.height - 330, width: 50, height: 200},
];

const keys = {
  ArrowLeft: false,
  ArrowRight: false,
  ArrowUp: false,
  ArrowDown: false
};

let arrowReady = false; 
let arrowChargeStart = 0;
let arrows = [];

// Klavye olayları
document.addEventListener('keydown', e => {
  if(keys.hasOwnProperty(e.key)) keys[e.key] = true;

  if(e.key === "ArrowDown" && !arrowReady) {
    arrowReady = true;
    arrowChargeStart = Date.now();
  }
});

document.addEventListener('keyup', e => {
  if(keys.hasOwnProperty(e.key)) keys[e.key] = false;

  if(e.key === "ArrowDown" && arrowReady) {
    arrowReady = false;
    let holdTime = (Date.now() - arrowChargeStart) / 1000;
    if(holdTime > 3) holdTime = 3;
    let speed = 10 + (holdTime / 3) * 20;
    arrows.push({
      x: char.x + char.width / 2,
      y: char.y + char.height / 2,
      dx: speed,
      dy: -3
    });
  }
});

// Mouse ile tuşlara tıklama
function setupButton(id, keyName) {
  const btn = document.getElementById(id);
  btn.addEventListener('mousedown', () => keys[keyName] = true);
  btn.addEventListener('mouseup', () => keys[keyName] = false);
  btn.addEventListener('touchstart', e => { e.preventDefault(); keys[keyName] = true; });
  btn.addEventListener('touchend', e => { e.preventDefault(); keys[keyName] = false; });
}

setupButton("up", "ArrowUp");
setupButton("down", "ArrowDown");
setupButton("left", "ArrowLeft");
setupButton("right", "ArrowRight");

function update() {
  char.dx = 0;
  if(keys.ArrowLeft) char.dx = -char.speed;
  if(keys.ArrowRight) char.dx = char.speed;

  // merdivende yukarı çıkma
  let onLadder = false;
  ladders.forEach(l => {
    if(char.x + char.width > l.x &&
       char.x < l.x + l.width &&
       char.y + char.height > l.y &&
       char.y < l.y + l.height) {
      onLadder = true;
    }
  });

  if(onLadder && keys.ArrowUp) {
    char.dy = -char.speed;
  } else {
    if(keys.ArrowUp && char.onGround) {
      char.dy = -char.jumpPower;
      char.onGround = false;
    }
    char.dy += gravity;
  }

  char.x += char.dx;
  char.y += char.dy;

  char.onGround = false;
  platforms.forEach(p => {
    if(char.x + char.width > p.x &&
       char.x < p.x + p.width &&
       char.y + char.height > p.y &&
       char.y + char.height < p.y + p.height + char.dy) {
      char.y = p.y - char.height;
      char.dy = 0;
      char.onGround = true;
    }
  });

  if(char.x < 0) char.x = 0;
  if(char.x + char.width > canvas.width) char.x = canvas.width - char.width;
  if(char.y < 0) char.y = 0;
  if(char.y + char.height > canvas.height) char.y = canvas.height - char.height;

  // okları hareket ettir ve yerçekimi uygula
  const arrowGravity = 0.05;
  arrows.forEach(a => {
    if(a.dy !== 0) {
      a.x += a.dx;
      a.y += a.dy;
      a.dy += arrowGravity;

      // platform çarpışması
      platforms.forEach(p => {
        if(a.x + 15 > p.x && a.x < p.x + p.width && a.y + 5 > p.y && a.y + 5 < p.y + p.height) {
          a.y = p.y - 5;
          a.dy = 0;
          a.dx = 0;
        }
      });
    }
  });

  draw();
  requestAnimationFrame(update);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.imageSmoothingEnabled = false;
  ctx.drawImage(mapImg, 0, 0, mapImg.width, mapImg.height, 0, 0, canvas.width, canvas.height);

  if(arrowReady) {
    ctx.drawImage(characterImgArrow, char.x, char.y, char.width, char.height);
  } else {
    ctx.drawImage(characterImg, char.x, char.y, char.width, char.height);
  }

  arrows.forEach(a => {
    ctx.drawImage(arrowImg, a.x, a.y, 30, 10);
  });
}

mapImg.onload = () => {
  characterImg.onload = () => {
    characterImgArrow.onload = () => {
      arrowImg.onload = () => {
        update();
      }
    }
  };
};
</script>

</body>
</html>
